<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jy.importservice.mapper.ImportSubTaskMapper">
  <resultMap id="BaseResultMap" type="com.jy.importservice.entity.ImportSubTask">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="rule_table_id" jdbcType="VARCHAR" property="ruleTableId" />
    <result column="task_id" jdbcType="VARCHAR" property="taskId" />
    <result column="sqlldr_info_id" jdbcType="VARCHAR" property="sqlldrInfoId" />
    <result column="task_log_id" jdbcType="VARCHAR" property="taskLogId" />
    <result column="file_path" jdbcType="VARCHAR" property="filePath" />
    <result column="file_name" jdbcType="VARCHAR" property="fileName" />
    <result column="file_size" jdbcType="BIGINT" property="fileSize" />
    <result column="file_record_rows" jdbcType="BIGINT" property="fileRecordRows" />
    <result column="start_time" jdbcType="TIMESTAMP" property="startTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
    <result column="delete_time" jdbcType="TIMESTAMP" property="deleteTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="circle_time" jdbcType="TIMESTAMP" property="circleTime" />
    <result column="error_msg" jdbcType="LONGVARCHAR" property="errorMsg" />
    <result column="ctl_file_content" jdbcType="LONGVARCHAR" property="ctlFileContent" />
  </resultMap>
  <sql id="Base_Column_List">
    id, rule_table_id, task_id, sqlldr_info_id, task_log_id, file_path, file_name, file_size, 
    file_record_rows, start_time, end_time, delete_time, update_time, circle_time, error_msg, ctl_file_content
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" />
    from t_import_subtask
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="selectByPage" resultType="com.jy.importservice.entity.ImportSubTask">
    select l.id, l.task_id taskId, t.task_status taskStatus, l.start_time startTime
    from t_import_subtask l
    inner join t_import_task t
    on l.task_id = t.task_id
    <where>
      <if test="taskStatus != null and taskStatus != ''">
        t.task_status = #{taskStatus}
      </if>
    </where>
    order by id asc
    limit #{pageNo}, #{pageSize}
  </select>
  <select id="selectTotalSize" resultType="java.lang.Long">
    select count(1)
    from t_import_subtask
  </select>
  <select id="selectDetails" resultType="com.jy.importservice.entity.ImportSubTask">
    select r.target_table_name tableName, i.sqlldr_info_name sqlldrInfoName, file_path filePath, file_name fileName, file_record_rows fileRecordRows,
           circle_time circleTime, t.task_status taskStatus, start_time startTime, end_time endTime, delete_time deleteTime, error_msg errorMsg, ctl_file_content ctlFileContent
    from t_import_subtask l
           inner join t_import_rule_table r
                      on l.rule_table_id = r.rule_table_id
           inner join t_import_sqlldr_info i
                      on l.sqlldr_info_id = i.sqlldr_info_id
           inner join t_import_task t
                      on t.task_id = l.task_id
    where l.id = #{id}
  </select>
  <select id="lockResource" resultType="java.lang.Integer">
    select count(1)
    from t_import_subtask
    <where>
      <foreach collection="ids" item="id">
        or id like #{id}
      </foreach>
    </where>
    for update
  </select>
  <select id="selectSubStaskIds" resultType="java.lang.Long">
    select id
    from t_import_subtask
    <where>
      <foreach collection="taskIds" item="taskId">
        or task_id like #{taskId}
      </foreach>
    </where>
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    delete from t_import_subtask
    <where>
      <foreach collection="ids" item="id">
        or id like #{id}
      </foreach>
    </where>
  </delete>
  <insert id="insert" parameterType="com.jy.importservice.entity.ImportSubTask">
    insert into t_import_subtask (id, rule_table_id, task_id, 
      sqlldr_info_id, task_log_id, file_path, 
      file_name, file_size, file_record_rows, 
      start_time, end_time, delete_time, 
      update_time, circle_time, error_msg, 
      ctl_file_content)
    values (#{id,jdbcType=BIGINT}, #{ruleTableId,jdbcType=VARCHAR}, #{taskId,jdbcType=VARCHAR}, 
      #{sqlldrInfoId,jdbcType=VARCHAR}, #{taskLogId,jdbcType=VARCHAR}, #{filePath,jdbcType=VARCHAR}, 
      #{fileName,jdbcType=VARCHAR}, #{fileSize,jdbcType=BIGINT}, #{fileRecordRows,jdbcType=BIGINT}, 
      #{startTime,jdbcType=TIMESTAMP}, #{endTime,jdbcType=TIMESTAMP}, #{deleteTime,jdbcType=TIMESTAMP}, 
      #{updateTime,jdbcType=TIMESTAMP}, #{circleTime,jdbcType=TIMESTAMP}, #{errorMsg,jdbcType=LONGVARCHAR}, 
      #{ctlFileContent,jdbcType=LONGVARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.jy.importservice.entity.ImportSubTask">
    insert into t_import_subtask
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="ruleTableId != null">
        rule_table_id,
      </if>
      <if test="taskId != null">
        task_id,
      </if>
      <if test="sqlldrInfoId != null">
        sqlldr_info_id,
      </if>
      <if test="taskLogId != null">
        task_log_id,
      </if>
      <if test="filePath != null">
        file_path,
      </if>
      <if test="fileName != null">
        file_name,
      </if>
      <if test="fileSize != null">
        file_size,
      </if>
      <if test="fileRecordRows != null">
        file_record_rows,
      </if>
      <if test="startTime != null">
        start_time,
      </if>
      <if test="endTime != null">
        end_time,
      </if>
      <if test="deleteTime != null">
        delete_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="circleTime != null">
        circle_time,
      </if>
      <if test="errorMsg != null">
        error_msg,
      </if>
      <if test="ctlFileContent != null">
        ctl_file_content,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=BIGINT},
      </if>
      <if test="ruleTableId != null">
        #{ruleTableId,jdbcType=VARCHAR},
      </if>
      <if test="taskId != null">
        #{taskId,jdbcType=VARCHAR},
      </if>
      <if test="sqlldrInfoId != null">
        #{sqlldrInfoId,jdbcType=VARCHAR},
      </if>
      <if test="taskLogId != null">
        #{taskLogId,jdbcType=VARCHAR},
      </if>
      <if test="filePath != null">
        #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="fileName != null">
        #{fileName,jdbcType=VARCHAR},
      </if>
      <if test="fileSize != null">
        #{fileSize,jdbcType=BIGINT},
      </if>
      <if test="fileRecordRows != null">
        #{fileRecordRows,jdbcType=BIGINT},
      </if>
      <if test="startTime != null">
        #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null">
        #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deleteTime != null">
        #{deleteTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="circleTime != null">
        #{circleTime,jdbcType=TIMESTAMP},
      </if>
      <if test="errorMsg != null">
        #{errorMsg,jdbcType=LONGVARCHAR},
      </if>
      <if test="ctlFileContent != null">
        #{ctlFileContent,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jy.importservice.entity.ImportSubTask">
    update t_import_subtask
    <set>
      <if test="ruleTableId != null">
        rule_table_id = #{ruleTableId,jdbcType=VARCHAR},
      </if>
      <if test="taskId != null">
        task_id = #{taskId,jdbcType=VARCHAR},
      </if>
      <if test="sqlldrInfoId != null">
        sqlldr_info_id = #{sqlldrInfoId,jdbcType=VARCHAR},
      </if>
      <if test="taskLogId != null">
        task_log_id = #{taskLogId,jdbcType=VARCHAR},
      </if>
      <if test="filePath != null">
        file_path = #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="fileName != null">
        file_name = #{fileName,jdbcType=VARCHAR},
      </if>
      <if test="fileSize != null">
        file_size = #{fileSize,jdbcType=BIGINT},
      </if>
      <if test="fileRecordRows != null">
        file_record_rows = #{fileRecordRows,jdbcType=BIGINT},
      </if>
      <if test="startTime != null">
        start_time = #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null">
        end_time = #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deleteTime != null">
        delete_time = #{deleteTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="circleTime != null">
        circle_time = #{circleTime,jdbcType=TIMESTAMP},
      </if>
      <if test="errorMsg != null">
        error_msg = #{errorMsg,jdbcType=LONGVARCHAR},
      </if>
      <if test="ctlFileContent != null">
        ctl_file_content = #{ctlFileContent,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jy.importservice.entity.ImportSubTask">
    update t_import_subtask
    set rule_table_id = #{ruleTableId,jdbcType=VARCHAR},
      task_id = #{taskId,jdbcType=VARCHAR},
      sqlldr_info_id = #{sqlldrInfoId,jdbcType=VARCHAR},
      task_log_id = #{taskLogId,jdbcType=VARCHAR},
      file_path = #{filePath,jdbcType=VARCHAR},
      file_name = #{fileName,jdbcType=VARCHAR},
      file_size = #{fileSize,jdbcType=BIGINT},
      file_record_rows = #{fileRecordRows,jdbcType=BIGINT},
      start_time = #{startTime,jdbcType=TIMESTAMP},
      end_time = #{endTime,jdbcType=TIMESTAMP},
      delete_time = #{deleteTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      circle_time = #{circleTime,jdbcType=TIMESTAMP},
      error_msg = #{errorMsg,jdbcType=LONGVARCHAR},
      ctl_file_content = #{ctlFileContent,jdbcType=LONGVARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
</mapper>